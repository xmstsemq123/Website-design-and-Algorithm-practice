<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¥µé€Ÿæª”æ¡ˆæª¢ç´¢ - æ•ˆèƒ½æ¸¬è©•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 4px; }
        .console-text { font-family: 'Menlo', 'Monaco', 'Courier New', monospace; }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen p-8 flex justify-center items-start">

    <div class="w-full max-w-3xl space-y-6">
        
        <div class="bg-gray-800 rounded-xl shadow-lg border border-gray-700 overflow-hidden">
            <header class="bg-cyan-900/80 p-6 border-b border-cyan-700/50 flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold text-white flex items-center gap-2">
                        âš¡ æ¥µé€Ÿæª¢ç´¢æ¸¬è©•å™¨ (Search Benchmark)
                    </h1>
                    <p class="text-cyan-200 text-sm mt-1 opacity-80">é™åˆ¶è®€å–æ¬¡æ•¸: <span class="text-yellow-400 font-bold">100</span> æ¬¡/æ¯ç­†æŸ¥è©¢</p>
                </div>
                <div id="status-badge" class="px-4 py-2 rounded-lg font-bold bg-gray-700 text-gray-400 text-sm">
                    Ready
                </div>
            </header>

            <div id="test-list" class="p-6 space-y-3"></div>

            <div class="p-4 bg-gray-900/50 border-t border-gray-700 flex justify-end">
                <button onclick="runTests()" class="px-6 py-2 bg-cyan-600 hover:bg-cyan-500 text-white rounded shadow-lg font-bold transition-transform hover:scale-105">
                    é–‹å§‹æ•ˆèƒ½æ¸¬è©¦
                </button>
            </div>
        </div>

        <div class="bg-black rounded-xl shadow-lg border border-gray-700 overflow-hidden font-mono text-xs md:text-sm h-64 flex flex-col">
            <div class="bg-gray-800 px-4 py-2 text-gray-400 border-b border-gray-700">Debug Console</div>
            <div id="console-output" class="flex-1 overflow-y-auto p-4 space-y-1 console-text text-gray-300">
                <div class="opacity-50">> System initialized. Waiting for solver.js...</div>
            </div>
        </div>

    </div>

    <script src="solver.js"></script>

    <script>
        const testList = document.getElementById('test-list');
        const consoleOutput = document.getElementById('console-output');
        const statusBadge = document.getElementById('status-badge');
        let hasError = false;

        // ç”¢ç”Ÿ 10,000 ç­†å·²æ’åºè³‡æ–™
        const DATA_SIZE = 10000;
        
        // --- é€™è£¡æ›´æ–°äº†æœ€å¤§æ¬¡æ•¸é™åˆ¶ ---
        const MAX_STEPS = 100; 
        
        const sortedData = [];
        for (let i = 0; i < DATA_SIZE; i++) {
            // ç”¢ç”Ÿç”±å°åˆ°å¤§çš„æ•¸å­—ï¼Œä¾‹å¦‚ 2, 5, 8, 12...
            sortedData.push((i * 2) + Math.floor(Math.random() * 2));
        }

        function log(msg, type = 'info') {
            const div = document.createElement('div');
            const time = new Date().toLocaleTimeString('en-US', {hour12:false});
            div.className = type === 'error' ? "text-red-400" : type === 'success' ? "text-green-400" : "text-gray-300";
            div.innerHTML = `<span class="opacity-50">[${time}]</span> ${msg}`;
            consoleOutput.appendChild(div);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        function addResult(title, passed, detail) {
            const div = document.createElement('div');
            div.className = `flex justify-between items-center p-3 rounded border ${passed ? "bg-green-900/20 border-green-800" : "bg-red-900/20 border-red-800"}`;
            div.innerHTML = `
                <div>
                    <span class="font-bold ${passed ? 'text-green-400' : 'text-red-400'}">${passed ? 'âœ” PASS' : 'âœ˜ FAIL'}</span>
                    <span class="text-gray-200 ml-2 font-bold">${title}</span>
                </div>
                <div class="text-xs ${passed ? 'text-cyan-300' : 'text-red-300'}">${detail}</div>
            `;
            testList.appendChild(div);
            if (!passed) hasError = true;
        }

        // æ ¸å¿ƒï¼šå»ºç«‹ç›£è½é™£åˆ—çš„ Proxy
        function createMonitoredArray(originalArray) {
            let accessCount = 0;
            const proxy = new Proxy(originalArray, {
                get: function(target, prop) {
                    // åªè¨ˆç®—æ•¸å­—ç´¢å¼•çš„å­˜å– (arr[0], arr[100]...)
                    if (!isNaN(prop)) {
                        accessCount++;
                    }
                    return target[prop];
                }
            });
            return { proxy, getCount: () => accessCount };
        }

        async function runTests() {
            testList.innerHTML = '';
            hasError = false;
            statusBadge.className = "px-4 py-2 rounded-lg font-bold bg-blue-600 text-white animate-pulse";
            statusBadge.innerText = "Running...";
            
            log(`æº–å‚™æ¸¬è©¦è³‡æ–™ï¼š${DATA_SIZE} ç­† (å·²æ’åº)`, 'info');

            if (typeof search !== 'function') {
                log("éŒ¯èª¤ï¼šæ‰¾ä¸åˆ° search å‡½å¼", 'error');
                addResult("å‡½å¼å®šç¾©", false, "æ‰¾ä¸åˆ° search(arr, target)");
                statusBadge.className = "px-4 py-2 rounded-lg font-bold bg-red-500 text-white";
                statusBadge.innerText = "Error";
                return;
            }

            // é¸å– 5 å€‹æ¸¬è©¦ç›®æ¨™
            const testTargets = [
                { val: sortedData[0], desc: "é–‹é ­çš„å€¼" },
                { val: sortedData[Math.floor(DATA_SIZE / 2)], desc: "ä¸­é–“çš„å€¼" },
                { val: sortedData[DATA_SIZE - 1], desc: "çµå°¾çš„å€¼" },
                { val: sortedData[425], desc: "éš¨æ©Ÿå€¼ (Index: 425)" },
                { val: -999, desc: "ä¸å­˜åœ¨çš„å€¼ (æ‡‰å›å‚³ -1)" } 
            ];

            let totalSteps = 0;

            for (const test of testTargets) {
                const { proxy, getCount } = createMonitoredArray(sortedData);
                
                // åŸ·è¡Œå­¸ç”Ÿç¨‹å¼
                const resultIndex = search(proxy, test.val);
                const steps = getCount();
                totalSteps += steps;

                // é©—è­‰ç­”æ¡ˆæ˜¯å¦æ­£ç¢º
                let isCorrect = false;
                if (test.val === -999) {
                    isCorrect = (resultIndex === -1);
                } else {
                    isCorrect = (sortedData[resultIndex] === test.val);
                }

                // é©—è­‰æ¬¡æ•¸æ˜¯å¦è¶…æ¨™
                const isEfficient = steps <= MAX_STEPS;
                
                if (isCorrect && isEfficient) {
                    addResult(`å°‹æ‰¾ ${test.desc}`, true, `${steps} steps`);
                    log(`[PASS] ${test.desc} - è€—è²» ${steps} æ¬¡è®€å–`, 'success');
                } else if (!isCorrect) {
                    addResult(`å°‹æ‰¾ ${test.desc}`, false, `å›å‚³ç´¢å¼•éŒ¯èª¤`);
                    log(`[FAIL] ${test.desc} - é æœŸæ‰¾åˆ° ${test.val} ä½†å›å‚³ Index ${resultIndex}`, 'error');
                } else {
                    addResult(`å°‹æ‰¾ ${test.desc}`, false, `è¶…æ™‚ï¼è€—è²» ${steps} æ¬¡ (Limit: ${MAX_STEPS})`);
                    log(`[FAIL] ${test.desc} - è®€å–æ¬¡æ•¸éå¤š (${steps})ï¼Œè«‹ä½¿ç”¨æ›´æœ‰æ•ˆç‡çš„æœå°‹æ³•`, 'error');
                }

                await new Promise(r => setTimeout(r, 200));
            }

            if (!hasError) {
                statusBadge.className = "px-4 py-2 rounded-lg font-bold bg-green-500 text-white";
                statusBadge.innerText = "ğŸ‰ æŒ‘æˆ°æˆåŠŸ";
                log(`ç¸½çµï¼š5 æ¬¡æŸ¥è©¢å…±è€—è²» ${totalSteps} æ¬¡è®€å– (å¹³å‡ ${Math.round(totalSteps/5)} æ¬¡)ã€‚`, 'success');
            } else {
                statusBadge.className = "px-4 py-2 rounded-lg font-bold bg-red-500 text-white";
                statusBadge.innerText = "âš ï¸ æŒ‘æˆ°å¤±æ•—";
            }
        }
    </script>
</body>
</html>