<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¬æœƒæ•¸æ“šåˆ†æ - è‡ªå‹•æ¸¬è©•ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        .console-text { font-family: 'Menlo', 'Monaco', 'Courier New', monospace; }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen p-4 md:p-8 flex justify-center items-start">

    <div class="w-full max-w-4xl space-y-4">
        
        <div class="bg-gray-800 rounded-xl shadow-lg border border-gray-700 overflow-hidden">
            <header class="bg-cyan-900/80 p-6 border-b border-cyan-700/50 flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold text-white flex items-center gap-2">
                        ğŸ“Š å…¬æœƒæ•¸æ“šåˆ†æå„€ (Guild Analyst)
                    </h1>
                    <p class="text-cyan-200 text-sm mt-1 opacity-80">Array Methods è‡ªå‹•æ¸¬è©•</p>
                </div>
                <div id="status-badge" class="px-4 py-2 rounded-lg font-bold bg-gray-700 text-gray-400 text-sm">
                    ç­‰å¾…è³‡æ–™è¼¸å…¥...
                </div>
            </header>

            <div id="test-list" class="p-6 space-y-3"></div>

            <div class="p-4 bg-gray-900/50 border-t border-gray-700 flex justify-end gap-3">
                <button onclick="location.reload()" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded font-bold text-sm">é‡æ–°æ•´ç†</button>
                <button onclick="runTests()" class="px-6 py-2 bg-cyan-600 hover:bg-cyan-500 text-white rounded shadow-lg font-bold text-sm">é–‹å§‹åˆ†æ</button>
            </div>
        </div>

        <div class="bg-black rounded-xl shadow-lg border border-gray-700 overflow-hidden font-mono text-xs md:text-sm">
            <div class="bg-gray-800 px-4 py-2 text-gray-400 flex items-center gap-2 border-b border-gray-700">
                <span>System Log</span>
            </div>
            <div id="console-output" class="h-64 overflow-y-auto p-4 space-y-1 console-text text-gray-300">
                <div class="opacity-50">> System ready.</div>
            </div>
        </div>
    </div>

    <script src="analysis.js"></script>

    <script>
        // --- æ¸¬è©¦è³‡æ–™ ---
        const MOCK_DATA = [
            { id: 101, name: "Aragorn", role: "Warrior", level: 50, isReady: true, money: 500 },
            { id: 102, name: "Legolas", role: "Archer", level: 120, isReady: true, money: 1200 },
            { id: 103, name: "Gimli", role: "Warrior", level: 45, isReady: true, money: 300 },
            { id: 104, name: "Gandalf", role: "Mage", level: 999, isReady: false, money: 5000 },
            { id: 105, name: "Frodo", role: "Civilian", level: 5, isReady: true, money: 50 }
        ];

        const consoleOutput = document.getElementById('console-output');
        const testList = document.getElementById('test-list');
        const statusBadge = document.getElementById('status-badge');
        let hasError = false;

        function log(msg, type = 'info') {
            const div = document.createElement('div');
            const time = new Date().toLocaleTimeString('en-US', {hour12:false});
            div.className = type === 'error' ? "text-red-400" : type === 'success' ? "text-green-400" : "text-gray-300";
            div.innerHTML = `<span class="opacity-50">[${time}]</span> ${msg}`;
            consoleOutput.appendChild(div);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        function addResult(title, passed, msg = "") {
            const div = document.createElement('div');
            div.className = `flex justify-between items-center p-3 rounded border ${passed ? "bg-green-900/20 border-green-800" : "bg-red-900/20 border-red-800"}`;
            div.innerHTML = `
                <div>
                    <span class="font-bold ${passed ? 'text-green-400' : 'text-red-400'}">${passed ? 'âœ” PASS' : 'âœ˜ FAIL'}</span>
                    <span class="text-gray-200 ml-2">${title}</span>
                </div>
                ${!passed ? `<span class="text-xs text-red-300">${msg}</span>` : ''}
            `;
            testList.appendChild(div);
            if (!passed) hasError = true;
        }

        async function runTests() {
            testList.innerHTML = '';
            consoleOutput.innerHTML = '';
            hasError = false;
            statusBadge.className = "px-4 py-2 rounded-lg font-bold bg-blue-600 text-white animate-pulse";
            statusBadge.innerText = "åˆ†æä¸­...";

            log("è¼‰å…¥å†’éšªè€…è³‡æ–™...", 'info');
            log(`è³‡æ–™ç¸½æ•¸: ${MOCK_DATA.length} ç­†`);

            setTimeout(() => {
                try {
                    // 1. Filter Check
                    if (typeof getWarriors !== 'function') throw new Error("æ‰¾ä¸åˆ° getWarriors å‡½å¼");
                    const warriors = getWarriors(MOCK_DATA);
                    if (Array.isArray(warriors) && warriors.length === 2 && warriors.every(m => m.role === 'Warrior')) {
                        addResult("1. filter() - ç¯©é¸æˆ°å£«", true);
                        log("æˆåŠŸç¯©é¸å‡ºæ‰€æœ‰æˆ°å£«", 'success');
                    } else {
                        addResult("1. filter() - ç¯©é¸æˆ°å£«", false, "æ•¸é‡æˆ–è·æ¥­ä¸æ­£ç¢º");
                        log("Filter æ¸¬è©¦å¤±æ•—", 'error');
                    }

                    // 2. Map Check
                    if (typeof getNameTags !== 'function') throw new Error("æ‰¾ä¸åˆ° getNameTags å‡½å¼");
                    const tags = getNameTags(MOCK_DATA);
                    if (tags.length === 5 && tags[0] === "[Warrior] Aragorn" && typeof tags[0] === 'string') {
                        addResult("2. map() - ç”¢ç”Ÿåç‰Œ", true);
                        log("åç‰Œæ ¼å¼æ­£ç¢º", 'success');
                    } else {
                        addResult("2. map() - ç”¢ç”Ÿåç‰Œ", false, "æ ¼å¼æ‡‰ç‚º '[Role] Name'");
                        log("Map æ¸¬è©¦å¤±æ•—", 'error');
                    }

                    // 3. Find Check
                    if (typeof findGandalf !== 'function') throw new Error("æ‰¾ä¸åˆ° findGandalf å‡½å¼");
                    const gandalf = findGandalf(MOCK_DATA);
                    if (gandalf && gandalf.name === 'Gandalf') {
                        addResult("3. find() - å°‹æ‰¾ç‰¹å®šäººç‰©", true);
                        log("æˆåŠŸæ‰¾åˆ°ç”˜é“å¤«", 'success');
                    } else {
                        addResult("3. find() - å°‹æ‰¾ç‰¹å®šäººç‰©", false, "å›å‚³å€¼éŒ¯èª¤æˆ–æœªæ‰¾åˆ°");
                    }

                    // 4. Reduce Check
                    if (typeof calculateTotalMoney !== 'function') throw new Error("æ‰¾ä¸åˆ° calculateTotalMoney å‡½å¼");
                    const total = calculateTotalMoney(MOCK_DATA);
                    const expectedTotal = 500 + 1200 + 300 + 5000 + 50;
                    if (total === expectedTotal) {
                        addResult("4. reduce() - è¨ˆç®—ç¸½è³‡ç”¢", true);
                        log(`ç¸½é‡‘é¡è¨ˆç®—æ­£ç¢º: ${total}`, 'success');
                    } else {
                        addResult("4. reduce() - è¨ˆç®—ç¸½è³‡ç”¢", false, `é æœŸ ${expectedTotal}, å¾—åˆ° ${total}`);
                    }

                    // 5. Some/Every Check
                    if (typeof checkStatus !== 'function') throw new Error("æ‰¾ä¸åˆ° checkStatus å‡½å¼");
                    const status = checkStatus(MOCK_DATA);
                    if (status.isEveryoneReady === false && status.hasSuperStrong === true) {
                        addResult("5. every() & some() - ç‹€æ…‹æª¢æŸ¥", true);
                        log("éšŠä¼ç‹€æ…‹åˆ¤æ–·æ­£ç¢º", 'success');
                    } else {
                        addResult("5. every() & some() - ç‹€æ…‹æª¢æŸ¥", false, "åˆ¤æ–·é‚è¼¯æœ‰èª¤");
                    }

                     // 6. forEach Check
                     if (typeof tallyRoles !== 'function') throw new Error("æ‰¾ä¸åˆ° tallyRoles å‡½å¼");
                    const roleCounts = tallyRoles(MOCK_DATA);
                    if (roleCounts['Warrior'] === 2 && roleCounts['Mage'] === 1) {
                        addResult("6. forEach() - è·æ¥­çµ±è¨ˆ", true);
                        log("è·æ¥­çµ±è¨ˆæ­£ç¢º", 'success');
                    } else {
                        addResult("6. forEach() - è·æ¥­çµ±è¨ˆ", false, "æ•¸é‡è¨ˆç®—æœ‰èª¤");
                    }

                } catch (e) {
                    log(`åŸ·è¡ŒéŒ¯èª¤: ${e.message}`, 'error');
                    addResult("ç¨‹å¼åŸ·è¡ŒéŒ¯èª¤", false, e.message);
                }

                if (!hasError) {
                    statusBadge.className = "px-4 py-2 rounded-lg font-bold bg-green-500 text-white";
                    statusBadge.innerText = "ğŸ‰ å®Œç¾åˆ†æ";
                } else {
                    statusBadge.className = "px-4 py-2 rounded-lg font-bold bg-red-500 text-white";
                    statusBadge.innerText = "âš ï¸ åˆ†ææœ‰èª¤";
                }
            }, 500);
        }
    </script>
</body>
</html>