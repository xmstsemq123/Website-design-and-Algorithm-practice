<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹½éˆåˆ—è»Š - è‡ªå‹•æ¸¬è©•ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è‡ªå®šç¾©æ²è»¸æ¨£å¼ */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        
        .console-text { font-family: 'Menlo', 'Monaco', 'Courier New', monospace; }
        .blink { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen p-4 md:p-8 flex justify-center items-start">

    <div class="w-full max-w-3xl space-y-4">
        
        <div class="bg-gray-800 rounded-xl shadow-lg border border-gray-700 overflow-hidden">
            <header class="bg-purple-900/80 p-6 border-b border-purple-700/50 flex justify-between items-center backdrop-blur-sm">
                <div>
                    <h1 class="text-2xl font-bold text-white flex items-center gap-2">
                        ğŸ‘» å¹½éˆåˆ—è»Š (Ghost Train)
                    </h1>
                    <p class="text-purple-200 text-sm mt-1 opacity-80">Linked List è³‡æ–™çµæ§‹è‡ªå‹•æ¸¬è©•</p>
                </div>
                <div id="status-badge" class="px-4 py-2 rounded-lg font-bold bg-gray-700 text-gray-400 text-sm">
                    ç­‰å¾…æ¸¬è©¦...
                </div>
            </header>

            <div id="test-list" class="p-6 space-y-3 min-h-[100px]">
                </div>

            <div class="p-4 bg-gray-900/50 border-t border-gray-700 flex justify-end gap-3">
                <button onclick="location.reload()" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition text-sm font-bold">
                    é‡æ–°æ•´ç†
                </button>
                <button onclick="runTests()" class="px-6 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded shadow-lg shadow-purple-900/20 transition transform hover:-translate-y-0.5 text-sm font-bold">
                    åŸ·è¡Œæ¸¬è©¦ (Run Test)
                </button>
            </div>
        </div>

        <div class="bg-black rounded-xl shadow-lg border border-gray-700 overflow-hidden font-mono text-xs md:text-sm">
            <div class="bg-gray-800 px-4 py-2 text-gray-400 flex items-center gap-2 border-b border-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="4 17 10 11 4 5"/><line x1="12" x2="20" y1="19" y2="19"/></svg>
                <span>Debug Console</span>
            </div>
            <div id="console-output" class="h-64 overflow-y-auto p-4 space-y-1 console-text text-gray-300">
                <div class="opacity-50">> System ready. Waiting for linked_list.js...</div>
            </div>
        </div>

    </div>

    <script src="linked_list.js"></script>

    <script>
        // --- å·¥å…·å‡½å¼ ---
        const testList = document.getElementById('test-list');
        const consoleOutput = document.getElementById('console-output');
        const statusBadge = document.getElementById('status-badge');
        let hasError = false;

        // æ¨¡æ“¬ Console.log
        function log(msg, type = 'info') {
            const div = document.createElement('div');
            const timestamp = new Date().toLocaleTimeString('en-US', { hour12: false });
            
            if (type === 'error') {
                div.className = "text-red-400 border-l-2 border-red-500 pl-2";
                div.innerHTML = `<span class="opacity-50">[${timestamp}]</span> âŒ ${msg}`;
            } else if (type === 'success') {
                div.className = "text-green-400";
                div.innerHTML = `<span class="opacity-50">[${timestamp}]</span> âœ… ${msg}`;
            } else if (type === 'warn') {
                div.className = "text-yellow-400";
                div.innerHTML = `<span class="opacity-50">[${timestamp}]</span> âš ï¸ ${msg}`;
            } else {
                div.className = "text-gray-300";
                div.innerHTML = `<span class="opacity-50">[${timestamp}]</span> ${msg}`;
            }

            consoleOutput.appendChild(div);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        // æ–°å¢æ¸¬è©¦é …ç›® UI
        function addTestResult(title, passed, detail = "") {
            const div = document.createElement('div');
            div.className = `flex justify-between items-center p-3 rounded border transition-all ${
                passed 
                ? "bg-green-900/20 border-green-800 hover:bg-green-900/30" 
                : "bg-red-900/20 border-red-800 hover:bg-red-900/30"
            }`;
            
            div.innerHTML = `
                <div class="flex flex-col">
                    <span class="font-bold ${passed ? 'text-green-400' : 'text-red-400'}">
                        ${passed ? 'âœ” PASS' : 'âœ˜ FAIL'} : ${title}
                    </span>
                    ${!passed ? `<span class="text-xs text-red-300 mt-1">${detail}</span>` : ''}
                </div>
            `;
            testList.appendChild(div);
            
            if (!passed) hasError = true;
        }

        // ç­‰å¾…å‡½æ•¸ (è®“ UI æœ‰æ™‚é–“æ¸²æŸ“)
        const wait = (ms) => new Promise(resolve => setTimeout(resolve, ms));

        // --- ä¸»æ¸¬è©¦é‚è¼¯ ---
        async function runTests() {
            // é‡ç½® UI
            testList.innerHTML = '';
            consoleOutput.innerHTML = '';
            hasError = false;
            statusBadge.className = "px-4 py-2 rounded-lg font-bold bg-blue-600 text-white animate-pulse";
            statusBadge.textContent = "æ¸¬è©¦åŸ·è¡Œä¸­...";
            
            log("é–‹å§‹åŸ·è¡Œæ¸¬è©¦ç¨‹åº...", 'info');
            await wait(300);

            try {
                // 1. æª¢æŸ¥æª”æ¡ˆèˆ‡é¡åˆ¥å®šç¾©
                log("æª¢æŸ¥é¡åˆ¥å®šç¾© (Class Definitions)...");
                if (typeof Node === 'undefined') throw new Error("æ‰¾ä¸åˆ° 'Node' é¡åˆ¥ï¼Œè«‹ç¢ºèªæª”æ¡ˆåç¨±æ˜¯å¦ç‚º linked_list.js");
                if (typeof LinkedList === 'undefined') throw new Error("æ‰¾ä¸åˆ° 'LinkedList' é¡åˆ¥");
                
                // æª¢æŸ¥ Node å»ºæ§‹å­
                const tempNode = new Node("Test");
                if (tempNode.value !== "Test" || tempNode.next !== null) {
                    addTestResult("Node é¡åˆ¥çµæ§‹", false, "Node å¿…é ˆåŒ…å« value èˆ‡ next å±¬æ€§");
                    log("Node åˆå§‹åŒ–å¤±æ•—ï¼šå±¬æ€§ä¸æ­£ç¢º", 'error');
                } else {
                    addTestResult("Node é¡åˆ¥çµæ§‹", true);
                    log("Node é¡åˆ¥çµæ§‹æ­£ç¢º", 'success');
                }
                await wait(200);

                // 2. æ¸¬è©¦ append (ç©ºé™£åˆ—)
                log("æ¸¬è©¦ append() - åˆå§‹ç‹€æ…‹...");
                const train = new LinkedList();
                if (train.head !== null) {
                    addTestResult("LinkedList åˆå§‹åŒ–", false, "å‰›å»ºç«‹æ™‚ head æ‡‰ç‚º null");
                    throw new Error("LinkedList åˆå§‹åŒ–éŒ¯èª¤");
                }
                
                train.append("Engine");
                if (train.head && train.head.value === "Engine" && train.head.next === null) {
                    addTestResult("Append: åŠ å…¥ç¬¬ä¸€ç¯€è»Šå»‚ (Head)", true);
                    log("æˆåŠŸåŠ å…¥ Head: Engine", 'success');
                } else {
                    addTestResult("Append: åŠ å…¥ç¬¬ä¸€ç¯€è»Šå»‚ (Head)", false, "Head æœªæ­£ç¢ºæŒ‡å‘æ–°ç¯€é»");
                    log("Head è¨­å®šå¤±æ•—", 'error');
                    console.log("Debug: current head is", train.head);
                }
                await wait(200);

                // 3. æ¸¬è©¦ append (å¤šç¯€)
                log("æ¸¬è©¦ append() - ä¸²æ¥åŠŸèƒ½...");
                train.append("Carriage A");
                train.append("Carriage B");
                
                let debugString = "Current List: ";
                let curr = train.head;
                while(curr) { debugString += `[${curr.value}] -> `; curr = curr.next; }
                log(debugString + "null");

                if (train.head.next && train.head.next.value === "Carriage A") {
                    if (train.head.next.next && train.head.next.next.value === "Carriage B") {
                        addTestResult("Append: é€£çºŒåŠ å…¥å¤šç¯€è»Šå»‚", true);
                        log("ç¯€é»ä¸²æ¥æ­£ç¢º (Engine -> A -> B)", 'success');
                    } else {
                        addTestResult("Append: é€£çºŒåŠ å…¥å¤šç¯€è»Šå»‚", false, "ç¬¬ä¸‰å€‹ç¯€é» (Carriage B) é€£æ¥å¤±æ•—");
                        log("ç¬¬ä¸‰å€‹ç¯€é»éºå¤±", 'error');
                    }
                } else {
                    addTestResult("Append: é€£çºŒåŠ å…¥å¤šç¯€è»Šå»‚", false, "ç¬¬äºŒå€‹ç¯€é» (Carriage A) é€£æ¥å¤±æ•—");
                    log("ç¬¬äºŒå€‹ç¯€é»éºå¤±", 'error');
                }
                await wait(200);

                // 4. æ¸¬è©¦ toString
                log("æ¸¬è©¦ toString()...");
                if (typeof train.toString !== 'function') {
                    addTestResult("toString æ–¹æ³•", false, "æœªå®šç¾© toString æ–¹æ³•");
                } else {
                    const str = train.toString();
                    log(`è¼¸å‡ºçµæœ: "${str}"`);
                    if (str.includes("Engine") && str.includes("Carriage B")) {
                        addTestResult("toString è¼¸å‡ºæ ¼å¼", true);
                        log("å­—ä¸²è¼¸å‡ºåŒ…å«æ­£ç¢ºå…§å®¹", 'success');
                    } else {
                        addTestResult("toString è¼¸å‡ºæ ¼å¼", false, "è¼¸å‡ºå­—ä¸²ç¼ºå°‘é—œéµå…§å®¹");
                        log("å­—ä¸²æª¢æŸ¥å¤±æ•—", 'error');
                    }
                }
                await wait(200);

                // 5. æ¸¬è©¦ removeLast (åŠ åˆ†é¡Œ)
                log("æ¸¬è©¦ removeLast (åŠ åˆ†é¡Œ)...");
                if (typeof train.removeLast !== 'function') {
                    log("æœªå¯¦ä½œ removeLastï¼Œè·³éæ¸¬è©¦", 'warn');
                    addTestResult("RemoveLast (åŠ åˆ†é¡Œ)", true, "æœªå¯¦ä½œ (è¦–ç‚º Pass)");
                } else {
                    train.removeLast(); // æ‡‰è©²ç§»é™¤ B
                    
                    // æª¢æŸ¥ B æ˜¯å¦æ¶ˆå¤±
                    let isB_Gone = true;
                    let temp = train.head;
                    while(temp) {
                        if (temp.value === "Carriage B") isB_Gone = false;
                        temp = temp.next;
                    }

                    if (isB_Gone && train.head.next.next === null) {
                        addTestResult("RemoveLast åŠŸèƒ½", true);
                        log("æˆåŠŸç§»é™¤æœ€å¾Œä¸€ç¯€è»Šå»‚", 'success');
                    } else {
                        addTestResult("RemoveLast åŠŸèƒ½", false, "ç§»é™¤å¾Œçµæ§‹ä¸æ­£ç¢ºæˆ–ç¯€é»ä»åœ¨");
                        log("ç§»é™¤å¤±æ•—", 'error');
                    }
                }

            } catch (err) {
                log(`åŸ·è¡Œæ™‚ç™¼ç”ŸéŒ¯èª¤: ${err.message}`, 'error');
                addTestResult("ç³»çµ±åŸ·è¡ŒéŒ¯èª¤", false, err.message);
            }

            // æœ€çµ‚çµæœåˆ¤å®š
            if (!hasError) {
                statusBadge.className = "px-4 py-2 rounded-lg font-bold bg-green-500 text-white";
                statusBadge.textContent = "ğŸ‰ é€šéæ‰€æœ‰æ¸¬è©¦";
                log("æ¸¬è©¦çµæŸï¼šçµæœå®Œç¾ï¼", 'success');
                // å½©è›‹
                log("ğŸ‘» å¹½éˆåˆ—è»Šæº–å‚™ç™¼è»Š...", 'info');
            } else {
                statusBadge.className = "px-4 py-2 rounded-lg font-bold bg-red-500 text-white";
                statusBadge.textContent = "âš ï¸ æ¸¬è©¦æœªé€šé";
                log("æ¸¬è©¦çµæŸï¼šè«‹ä¿®æ­£éŒ¯èª¤å¾Œé‡è©¦ã€‚", 'error');
            }
        }

        // é é¢è¼‰å…¥å¾Œè‡ªå‹•å˜—è©¦åŸ·è¡Œä¸€æ¬¡ (å¦‚æœæª”æ¡ˆå­˜åœ¨)
        window.onload = () => {
            log("System initialized.");
            // å»¶é²ä¸€é»é»åŸ·è¡Œï¼Œç¢ºä¿ user çœ‹åˆ°å‹•ç•«
            setTimeout(() => {
                if (typeof LinkedList !== 'undefined') {
                    runTests();
                } else {
                    log("è­¦å‘Šï¼šæ‰¾ä¸åˆ° linked_list.jsï¼Œè«‹ç¢ºä¿æª”æ¡ˆåœ¨åŒä¸€ç›®éŒ„ä¸‹ã€‚", 'warn');
                    addTestResult("æª”æ¡ˆè®€å–", false, "æ‰¾ä¸åˆ° linked_list.js");
                    statusBadge.className = "px-4 py-2 rounded-lg font-bold bg-red-500 text-white";
                    statusBadge.textContent = "æª”æ¡ˆéºå¤±";
                }
            }, 500);
        };
    </script>
</body>
</html>