<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ··æ²Œæª”æ¡ˆé¤¨ - æ•ˆèƒ½æ¸¬è©•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 4px; }
        .console-text { font-family: 'Menlo', 'Monaco', 'Courier New', monospace; }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen p-8 flex justify-center items-start">

    <div class="w-full max-w-3xl space-y-6">
        
        <div class="bg-gray-800 rounded-xl shadow-lg border border-gray-700 overflow-hidden">
            <header class="bg-rose-900/80 p-6 border-b border-rose-700/50 flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold text-white flex items-center gap-2">
                        ğŸ”¥ æ’åºæ•ˆèƒ½å£“åŠ›æ¸¬è©¦
                    </h1>
                    <p class="text-rose-200 text-sm mt-1 opacity-80">è³‡æ–™é‡: 10,000 | é™åˆ¶æ¬¡æ•¸: 500,000</p>
                </div>
                <div id="status-badge" class="px-4 py-2 rounded-lg font-bold bg-gray-700 text-gray-400 text-sm">
                    Ready
                </div>
            </header>

            <div id="test-list" class="p-6 space-y-3"></div>

            <div class="p-4 bg-gray-900/50 border-t border-gray-700 flex justify-end">
                <button onclick="runTests()" class="px-6 py-2 bg-rose-600 hover:bg-rose-500 text-white rounded shadow-lg font-bold transition-transform hover:scale-105">
                    é–‹å§‹å£“åŠ›æ¸¬è©¦
                </button>
            </div>
        </div>

        <div class="bg-black rounded-xl shadow-lg border border-gray-700 overflow-hidden font-mono text-xs md:text-sm h-64 flex flex-col">
            <div class="bg-gray-800 px-4 py-2 text-gray-400 border-b border-gray-700">Debug Console</div>
            <div id="console-output" class="flex-1 overflow-y-auto p-4 space-y-1 console-text text-gray-300">
                <div class="opacity-50">> System initialized.</div>
            </div>
        </div>

    </div>

    <script src="sorter.js"></script>

    <script>
        const testList = document.getElementById('test-list');
        const consoleOutput = document.getElementById('console-output');
        const statusBadge = document.getElementById('status-badge');
        let hasError = false;

        const N = 10000;
        // O(N^2) ç´„ 100,000,000 æ¬¡ -> çµ•å°ä¸å…è¨±
        // O(N log N) ç´„ 140,000 æ¬¡ -> åŠ ä¸Šä¸€äº› overhead è¨­å¯¬ä¸€é»
        const MAX_OPS = 500000; 

        // 1. é˜²æ­¢ä½œå¼Šï¼šè¦†å¯«åŸç”Ÿ sort
        Array.prototype.sort = function() {
            throw new Error("ğŸš« ç¦æ­¢ä½¿ç”¨ Array.prototype.sortï¼è«‹è‡ªå·±å¯¦ä½œæ¼”ç®—æ³•ã€‚");
        };

        function log(msg, type = 'info') {
            const div = document.createElement('div');
            const time = new Date().toLocaleTimeString('en-US', {hour12:false});
            div.className = type === 'error' ? "text-red-400" : type === 'success' ? "text-green-400" : "text-gray-300";
            div.innerHTML = `<span class="opacity-50">[${time}]</span> ${msg}`;
            consoleOutput.appendChild(div);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        function addResult(title, passed, detail) {
            const div = document.createElement('div');
            div.className = `flex justify-between items-center p-3 rounded border ${passed ? "bg-green-900/20 border-green-800" : "bg-red-900/20 border-red-800"}`;
            div.innerHTML = `
                <div>
                    <span class="font-bold ${passed ? 'text-green-400' : 'text-red-400'}">${passed ? 'âœ” PASS' : 'âœ˜ FAIL'}</span>
                    <span class="text-gray-200 ml-2 font-bold">${title}</span>
                </div>
                <div class="text-xs ${passed ? 'text-rose-300' : 'text-red-300'}">${detail}</div>
            `;
            testList.appendChild(div);
            if (!passed) hasError = true;
        }

        // å»ºç«‹ç›£æ§é™£åˆ—
        function createMonitoredArray(originalArray) {
            let opsCount = 0;
            const proxy = new Proxy(originalArray, {
                get: function(target, prop) {
                    if (!isNaN(prop)) opsCount++; // è®€å– array[i]
                    return target[prop];
                },
                set: function(target, prop, value) {
                    if (!isNaN(prop)) opsCount++; // å¯«å…¥ array[i] = x
                    target[prop] = value;
                    return true;
                }
            });
            return { proxy, getCount: () => opsCount };
        }

        function isSorted(arr) {
            for (let i = 0; i < arr.length - 1; i++) {
                if (arr[i] > arr[i + 1]) return false;
            }
            return true;
        }

        async function runTests() {
            testList.innerHTML = '';
            hasError = false;
            statusBadge.className = "px-4 py-2 rounded-lg font-bold bg-blue-600 text-white animate-pulse";
            statusBadge.innerText = "Processing...";
            
            // ç”¢ç”Ÿæ¸¬è©¦è³‡æ–™
            const data = Array.from({length: N}, () => Math.floor(Math.random() * 100000));
            log(`ç”¢ç”Ÿ ${N} ç­†éš¨æ©Ÿè³‡æ–™...`, 'info');

            // ç¨å¾®å»¶é²è®“ UI æ¸²æŸ“
            await new Promise(r => setTimeout(r, 100));

            try {
                if (typeof superSort !== 'function') {
                    throw new Error("æ‰¾ä¸åˆ° superSort å‡½å¼");
                }

                // é–‹å§‹ç›£æ§
                const { proxy, getCount } = createMonitoredArray([...data]); // è¤‡è£½ä¸€ä»½ä»¥å…æ±™æŸ“åŸè³‡æ–™
                
                const startTime = performance.now();
                const sortedResult = superSort(proxy);
                const endTime = performance.now();
                
                const totalOps = getCount();
                const timeTaken = (endTime - startTime).toFixed(2);

                log(`åŸ·è¡Œå®Œç•¢ï¼Œè€—æ™‚ ${timeTaken}ms`, 'info');
                log(`ç¸½æ“ä½œæ¬¡æ•¸ (Ops): ${totalOps}`, 'info');

                // æª¢æŸ¥ 1: æ˜¯å¦æ’åºæ­£ç¢º
                if (isSorted(sortedResult) && sortedResult.length === N) {
                    addResult("æ’åºæ­£ç¢ºæ€§", true, "é™£åˆ—å·²æ­£ç¢ºç”±å°åˆ°å¤§æ’åˆ—");
                } else {
                    addResult("æ’åºæ­£ç¢ºæ€§", false, "é™£åˆ—æœªæ­£ç¢ºæ’åºæˆ–é•·åº¦éŒ¯èª¤");
                    log("éŒ¯èª¤ï¼šæ’åºçµæœä¸æ­£ç¢º", 'error');
                }

                // æª¢æŸ¥ 2: æ•ˆèƒ½æ˜¯å¦é”æ¨™
                if (totalOps <= MAX_OPS) {
                    addResult("æ•ˆèƒ½æª¢æ¸¬", true, `æ¶ˆè€— ${totalOps} æ¬¡æ“ä½œ (é™åˆ¶: ${MAX_OPS})`);
                    log("æ•ˆèƒ½å„ªç•°ï¼æˆåŠŸé¿é–‹äº† O(N^2) çš„é™·é˜±ã€‚", 'success');
                } else {
                    addResult("æ•ˆèƒ½æª¢æ¸¬", false, `æ¶ˆè€— ${totalOps} æ¬¡æ“ä½œ (åš´é‡è¶…æ¨™!)`);
                    log(`è­¦å‘Šï¼šæ“ä½œæ¬¡æ•¸éå¤šã€‚å¦‚æœæ˜¯ Bubble Sortï¼Œæ¬¡æ•¸é€šå¸¸åœ¨ 50,000,000 ä»¥ä¸Šã€‚`, 'error');
                }

            } catch (e) {
                log(`ç™¼ç”ŸéŒ¯èª¤: ${e.message}`, 'error');
                addResult("åŸ·è¡ŒéŒ¯èª¤", false, e.message);
            }

            if (!hasError) {
                statusBadge.className = "px-4 py-2 rounded-lg font-bold bg-green-500 text-white";
                statusBadge.innerText = "ğŸ‰ å®Œç¾é€šé";
            } else {
                statusBadge.className = "px-4 py-2 rounded-lg font-bold bg-red-500 text-white";
                statusBadge.innerText = "âš ï¸ æ¸¬è©¦å¤±æ•—";
            }
        }
    </script>
</body>
</html>